<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1257">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title>Performance Considerations</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>EDEN</o:Author>
  <o:LastAuthor>EDEN</o:LastAuthor>
  <o:Revision>9</o:Revision>
  <o:TotalTime>4</o:TotalTime>
  <o:Created>2015-02-21T14:09:00Z</o:Created>
  <o:LastSaved>2015-02-21T14:16:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>417</o:Words>
  <o:Characters>2377</o:Characters>
  <o:Company>E</o:Company>
  <o:Lines>19</o:Lines>
  <o:Paragraphs>5</o:Paragraphs>
  <o:CharactersWithSpaces>2789</o:CharactersWithSpaces>
  <o:Version>11.9999</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:PunctuationKerning/>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h2
	{mso-margin-top-alt:auto;
	margin-right:0cm;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	mso-outline-level:2;
	font-size:18.0pt;
	font-family:"Times New Roman";
	font-weight:bold;}
h3
	{mso-margin-top-alt:auto;
	margin-right:0cm;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	mso-outline-level:3;
	font-size:13.5pt;
	font-family:"Times New Roman";
	font-weight:bold;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
p
	{mso-margin-top-alt:auto;
	margin-right:0cm;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
code
	{font-family:"Courier New";
	mso-ascii-font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Courier New";}
p.para, li.para, div.para
	{mso-style-name:para;
	mso-margin-top-alt:auto;
	margin-right:0cm;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
span.function
	{mso-style-name:function;}
@page Section1
	{size:612.0pt 792.0pt;
	margin:27.0pt 36.0pt 26.95pt 27.0pt;
	mso-header-margin:35.4pt;
	mso-footer-margin:35.4pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="3074"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=EN-US link=blue vlink=purple style='tab-interval:36.0pt'>

<div class=Section1>

<h2 align=center style='text-align:center'>Performance Considerations</h2>

<p class=para>We have already mentioned in the previous section that simply
collecting the possible roots had a very tiny performance impact, but this is
when you compare PHP 5.2 against PHP 5.3. Although the recording of possible
roots compared to not recording them at all, like in PHP 5.2, is slower, other
changes to the PHP runtime in PHP 5.3 prevented this particular performance
loss from even showing. </p>

<p class=para>There are two major areas in which performance is affected. The
first area is reduced memory usage, and the second area is run-time delay when
the garbage collection mechanism performs its memory cleanups. We will look at
both of those issues. </p>

<h3 align=center style='text-align:center'>Reduced Memory Usage</h3>

<p class=para>First of all, the whole reason for implementing the garbage
collection mechanism is to reduce memory usage by cleaning up
circular-referenced variables as soon as the prerequisites are fulfilled. In
PHP's implementation, this happens as soon as the root-buffer is full, or when
the function <span class=function><a
href="http://php.net/manual/en/function.gc-collect-cycles.php">gc_collect_cycles()</a></span>
is called. In the graph below, we display the memory usage of the script below,
in both PHP 5.2 and PHP 5.3, excluding the base memory that PHP itself uses
when starting up. </p>

<p><strong>Example #1 Memory usage example</strong></p>

<p class=MsoNormal><code><span style='font-size:10.0pt;color:#0000BB'>&lt;?php</span></code><span
style='font-size:10.0pt;font-family:"Courier New";color:#0000BB'><br>
</span><code><span style='font-size:10.0pt;color:#007700'>class&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#0000BB'>Foo</span></code><span style='font-size:
10.0pt;font-family:"Courier New";color:#0000BB'><br>
</span><code><span style='font-size:10.0pt;color:#007700'>{</span></code><span
style='font-size:10.0pt;font-family:"Courier New";color:#007700'><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</code></span><code><span
style='font-size:10.0pt;color:#0000BB'>$var&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#007700'>=&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#DD0000'>'3.14159265359'</span></code><code><span
style='font-size:10.0pt;color:#007700'>;</span></code><span style='font-size:
10.0pt;font-family:"Courier New";color:#007700'><br>
<code>}</code><br>
<br>
</span><code><span style='font-size:10.0pt;color:#0000BB'>$baseMemory&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#007700'>=&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#0000BB'>memory_get_usage</span></code><code><span
style='font-size:10.0pt;color:#007700'>();</span></code><span style='font-size:
10.0pt;font-family:"Courier New";color:#007700'><br>
<br>
<code>for&nbsp;(&nbsp;</code></span><code><span style='font-size:10.0pt;
color:#0000BB'>$i&nbsp;</span></code><code><span style='font-size:10.0pt;
color:#007700'>=&nbsp;</span></code><code><span style='font-size:10.0pt;
color:#0000BB'>0</span></code><code><span style='font-size:10.0pt;color:#007700'>;&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#0000BB'>$i&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#007700'>&lt;=&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#0000BB'>100000</span></code><code><span
style='font-size:10.0pt;color:#007700'>;&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#0000BB'>$i</span></code><code><span
style='font-size:10.0pt;color:#007700'>++&nbsp;)</span></code><span
style='font-size:10.0pt;font-family:"Courier New";color:#007700'><br>
<code>{</code><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;</code></span><code><span style='font-size:10.0pt;
color:#0000BB'>$a&nbsp;</span></code><code><span style='font-size:10.0pt;
color:#007700'>=&nbsp;new&nbsp;</span></code><code><span style='font-size:10.0pt;
color:#0000BB'>Foo</span></code><code><span style='font-size:10.0pt;color:#007700'>;</span></code><span
style='font-size:10.0pt;font-family:"Courier New";color:#007700'><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;</code></span><code><span style='font-size:10.0pt;
color:#0000BB'>$a</span></code><code><span style='font-size:10.0pt;color:#007700'>-&gt;</span></code><code><span
style='font-size:10.0pt;color:#0000BB'>self&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#007700'>=&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#0000BB'>$a</span></code><code><span
style='font-size:10.0pt;color:#007700'>;</span></code><span style='font-size:
10.0pt;font-family:"Courier New";color:#007700'><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;</code></span><code><span
style='font-size:10.0pt;color:#0000BB'>$i&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#007700'>%&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#0000BB'>500&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#007700'>===&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#0000BB'>0&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#007700'>)</span></code><span style='font-size:
10.0pt;font-family:"Courier New";color:#007700'><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;{</code><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</code></span><code><span
style='font-size:10.0pt;color:#0000BB'>sprintf</span></code><code><span
style='font-size:10.0pt;color:#007700'>(&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#DD0000'>'%8d:&nbsp;'</span></code><code><span
style='font-size:10.0pt;color:#007700'>,&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#0000BB'>$i&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#007700'>),&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#0000BB'>memory_get_usage</span></code><code><span
style='font-size:10.0pt;color:#007700'>()&nbsp;-&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#0000BB'>$baseMemory</span></code><code><span
style='font-size:10.0pt;color:#007700'>,&nbsp;</span></code><code><span
style='font-size:10.0pt;color:#DD0000'>&quot;\n&quot;</span></code><code><span
style='font-size:10.0pt;color:#007700'>;</span></code><span style='font-size:
10.0pt;font-family:"Courier New";color:#007700'><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;}</code><br>
<code>}</code><br>
</span><code><span style='font-size:10.0pt;color:#0000BB'>?&gt;</span></code><code><span
style='font-size:10.0pt;color:black'> </span></code></p>

<p class=MsoNormal><a href="html_data/image001.png"><span style='color:windowtext;
text-decoration:none;text-underline:none'><!--[if gte vml 1]><v:shapetype id="_x0000_t75"
 coordsize="21600,21600" o:spt="75" o:preferrelative="t" path="m@4@5l@4@11@9@11@9@5xe"
 filled="f" stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="_x0000_i1025" type="#_x0000_t75" alt="Comparison of memory usage between PHP 5.2 and PHP 5.3"
 style='width:565.5pt;height:319.5pt'>
 <v:imagedata src="html_data/image001.png" o:href="http://php.net/manual/en/images/12f37b1c6963c1c5c18f30495416a197-gc-benchmark.png"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=754 height=426
src="html_data/image002.gif"
alt="Comparison of memory usage between PHP 5.2 and PHP 5.3" v:shapes="_x0000_i1025"><![endif]></span></a></p>

<p class=para>In this very academic example, we are creating an object in which
a property is set to point back to the object itself. When the <var>$a</var>
variable in the script is re-assigned in the next iteration of the loop, a
memory leak would typically occur. In this case, two zval-containers are leaked
(the object zval, and the property zval), but only one possible root is found:
the variable that was unset. When the root-buffer is full after 10,000
iterations (with a total of 10,000 possible roots), the garbage collection mechanism
kicks in and frees the memory associated with those possible roots. This can
very clearly be seen in the jagged memory-usage graph for PHP 5.3. After each
10,000 iterations, the mechanism kicks in and frees the memory associated with
the circular referenced variables. The mechanism itself does not have to do a
whole lot of work in this example, because the structure that is leaked is
extremely simple. From the diagram, you see that the maximum memory usage in
PHP 5.3 is about 9 Mb, whereas in PHP 5.2 the memory usage keeps increasing. </p>

<p class=MsoNormal align=center style='text-align:center'><o:p>&nbsp;</o:p></p>

</div>

</body>

</html>
